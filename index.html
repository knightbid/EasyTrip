<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chia Tiền Đi Chơi (TripSplit AI) - Firebase</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#4F46E5',
              secondary: '#10B981',
              danger: '#EF4444',
            },
            animation: {
              'fade-in-down': 'fadeInDown 0.3s ease-out',
              'fade-in-up': 'fadeInUp 0.3s ease-out',
            },
            keyframes: {
              fadeInDown: {
                '0%': { opacity: '0', transform: 'translateY(-10px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              },
              fadeInUp: {
                '0%': { opacity: '0', transform: 'translateY(10px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' },
              },
            }
          }
        }
      }
    </script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Import Map for Modules -->
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.run/@google/genai@0.1.1",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
    "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0",
    "firebase/": "https://aistudiocdn.com/firebase@^12.6.0/"
  }
}
</script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Loading Overlay */
        #global-loader {
            position: fixed; inset: 0; background: rgba(255,255,255,0.95);
            z-index: 9999; display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(2px); transition: opacity 0.3s;
        }
        .hidden-loader { opacity: 0; pointer-events: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 antialiased min-h-screen flex flex-col">

    <!-- Setup Check Script -->
    <script>
        // Shim for process.env to avoid errors
        window.process = { env: { API_KEY: '' } };

        // Check if running via file:// protocol
        if (window.location.protocol === 'file:') {
            document.write(`
                <div style="position:fixed;inset:0;z-index:10000;background:white;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;text-align:center;font-family:sans-serif;">
                    <h1 style="color:#EF4444;font-size:24px;margin-bottom:10px;">⚠️ Lỗi Chạy File Trực Tiếp</h1>
                    <p style="max-width:500px;line-height:1.5;color:#374151;">
                        Bạn đang mở file này trực tiếp (file://). Trình duyệt sẽ chặn kết nối Firebase và Modules do chính sách bảo mật CORS.
                    </p>
                    <div style="margin-top:20px;background:#F3F4F6;padding:15px;border-radius:8px;text-align:left;">
                        <strong>Cách sửa (Dùng VS Code):</strong>
                        <ol style="margin-left:20px;margin-top:5px;">
                            <li>Cài Extension <strong>"Live Server"</strong>.</li>
                            <li>Chuột phải vào file index.html</li>
                            <li>Chọn <strong>"Open with Live Server"</strong>.</li>
                        </ol>
                    </div>
                </div>
            `);
            throw new Error("Execution stopped due to file protocol.");
        }
    </script>

    <!-- Loader -->
    <div id="global-loader">
        <div class="flex flex-col items-center text-center p-4">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-3"></div>
            <p class="text-indigo-600 font-medium animate-pulse" id="loader-text">Đang kết nối Firebase...</p>
            <p class="text-xs text-gray-400 mt-2 max-w-xs">Nếu quá lâu, hãy kiểm tra kết nối mạng hoặc F12 xem lỗi Console.</p>
        </div>
    </div>

    <div id="app" class="flex-1">
        <!-- App Content will be injected here by app.js -->
    </div>

    <!-- Modals Container -->
    <div id="modal-container"></div>

    <!-- Main Logic Script -->
    <script type="module" src="./app.js"></script>
</body>
</html>